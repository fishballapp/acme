import { expect, it } from "../../test_deps.ts";
import { decodeValidity } from "./decodeValidity.ts";

const PEM = `-----BEGIN CERTIFICATE-----
MIIEYzCCA+qgAwIBAgISBM3OiDo8vXAIZ4NsK19PdH67MAoGCCqGSM49BAMDMDIx
CzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJF
NjAeFw0yNDEwMTYwODA5MDlaFw0yNTAxMTQwODA5MDhaMEoxSDBGBgNVBAMTPzlh
MWQ5YjMyLWM4NmItNDNlZC04ZTkyLTA0Zjk0ZjQxZjY2Zi50ZXN0LmFjbWUucGtn
LmZpc2hiYWxsLnh5ejBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJVl3ekGtLlF
cNfEhmOHCLOVEemnyWOOXVv1tf5ErglibHnMVA1fG4I/ZgMeodQEKZ1ZNH71toMA
61hK9yqCRwqjggLGMIICwjAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0lBBYwFAYIKwYB
BQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAnV7Ib3s5hJ
QRwosQSRujLvILhzMB8GA1UdIwQYMBaAFJMnRpgDqVFojpjWxEJI2yO/WJTSMFUG
CCsGAQUFBwEBBEkwRzAhBggrBgEFBQcwAYYVaHR0cDovL2U2Lm8ubGVuY3Iub3Jn
MCIGCCsGAQUFBzAChhZodHRwOi8vZTYuaS5sZW5jci5vcmcvMIHOBgNVHREEgcYw
gcOCPzM0YWU4YzEzLWRhYmMtNDczZi1hNzhmLTkzNTQyMGYzZTAyNi50ZXN0LmFj
bWUucGtnLmZpc2hiYWxsLnh5eoI/OWExZDliMzItYzg2Yi00M2VkLThlOTItMDRm
OTRmNDFmNjZmLnRlc3QuYWNtZS5wa2cuZmlzaGJhbGwueHl6gj9lMmJiOWY0Mi1h
ODEzLTRjNDktODdjOC1iNWI1MmFkYmRkYmQudGVzdC5hY21lLnBrZy5maXNoYmFs
bC54eXowEwYDVR0gBAwwCjAIBgZngQwBAgEwggEEBgorBgEEAdZ5AgQCBIH1BIHy
APAAdwA/F0tP1yJHWJQdZRyEvg0S7ZA3fx+FauvBvyiF7PhkbgAAAZKUlTX3AAAE
AwBIMEYCIQCErVMxw3csVQFM3+BWpbaoxROhzUHQV+ky/ZjUEyBCowIhAMnbI6Qv
+Kxujx/PC+J8cbU2sYV+gSRheYcsCOuq3HZLAHUAzxFW7tUufK/zh1vZaS6b6Rpx
Z0qwF+ysAdJbd87MOwgAAAGSlJU2MwAABAMARjBEAiACvsQnAIcfeId85E9PyswD
pO1BzMoiuMmxWlmqP30OqAIgHpqm27Wf9IG/agaaRBEdPsFBdRe82wZHAFFEiQ3E
ip8wCgYIKoZIzj0EAwMDZwAwZAIwcY5tsdLBi+zAYuRVQrm6imDiwmiQhQkBpBlW
jpApJ4mxu/LiI/Anhmw/jCxt9cFQAjA9Bn3O5xmEian4GOadWxgw8QKwnAOBYA/M
68Xyq6zlg2zzpEac1bQgM0iNPe5vn6c=
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIEVzCCAj+gAwIBAgIRALBXPpFzlydw27SHyzpFKzgwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMjQwMzEzMDAwMDAw
WhcNMjcwMzEyMjM1OTU5WjAyMQswCQYDVQQGEwJVUzEWMBQGA1UEChMNTGV0J3Mg
RW5jcnlwdDELMAkGA1UEAxMCRTYwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAATZ8Z5G
h/ghcWCoJuuj+rnq2h25EqfUJtlRFLFhfHWWvyILOR/VvtEKRqotPEoJhC6+QJVV
6RlAN2Z17TJOdwRJ+HB7wxjnzvdxEP6sdNgA1O1tHHMWMxCcOrLqbGL0vbijgfgw
gfUwDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcD
ATASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBSTJ0aYA6lRaI6Y1sRCSNsj
v1iU0jAfBgNVHSMEGDAWgBR5tFnme7bl5AFzgAiIyBpY9umbbjAyBggrBgEFBQcB
AQQmMCQwIgYIKwYBBQUHMAKGFmh0dHA6Ly94MS5pLmxlbmNyLm9yZy8wEwYDVR0g
BAwwCjAIBgZngQwBAgEwJwYDVR0fBCAwHjAcoBqgGIYWaHR0cDovL3gxLmMubGVu
Y3Iub3JnLzANBgkqhkiG9w0BAQsFAAOCAgEAfYt7SiA1sgWGCIpunk46r4AExIRc
MxkKgUhNlrrv1B21hOaXN/5miE+LOTbrcmU/M9yvC6MVY730GNFoL8IhJ8j8vrOL
pMY22OP6baS1k9YMrtDTlwJHoGby04ThTUeBDksS9RiuHvicZqBedQdIF65pZuhp
eDcGBcLiYasQr/EO5gxxtLyTmgsHSOVSBcFOn9lgv7LECPq9i7mfH3mpxgrRKSxH
pOoZ0KXMcB+hHuvlklHntvcI0mMMQ0mhYj6qtMFStkF1RpCG3IPdIwpVCQqu8GV7
s8ubknRzs+3C/Bm19RFOoiPpDkwvyNfvmQ14XkyqqKK5oZ8zhD32kFRQkxa8uZSu
h4aTImFxknu39waBxIRXE4jKxlAmQc4QjFZoq1KmQqQg0J/1JF8RlFvJas1VcjLv
YlvUB2t6npO6oQjB3l+PNf0DpQH7iUx3Wz5AjQCi6L25FjyE06q6BZ/QlmtYdl/8
ZYao4SRqPEs/6cAiF+Qf5zg2UkaWtDphl1LKMuTNLotvsX99HP69V2faNyegodQ0
LyTApr/vT01YPE46vNsDLgK+4cL6TrzC/a4WcmF5SRJ938zrv/duJHLXQIku5v0+
EwOy59Hdm0PT/Er/84dDV0CSjdR/2XuZM3kpysSKLgD1cKiDA+IRguODCxfO9cyY
Ig46v9mFmBvyH04=
-----END CERTIFICATE-----`;

it("correctly decodes certificate validity dates", () => {
  const { notBefore, notAfter } = decodeValidity(PEM);

  // values got from https://lapo.it/asn1js/#MIIEYzCCA-qgAwIBAgISBM3OiDo8vXAIZ4NsK19PdH67MAoGCCqGSM49BAMDMDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJFNjAeFw0yNDEwMTYwODA5MDlaFw0yNTAxMTQwODA5MDhaMEoxSDBGBgNVBAMTPzlhMWQ5YjMyLWM4NmItNDNlZC04ZTkyLTA0Zjk0ZjQxZjY2Zi50ZXN0LmFjbWUucGtnLmZpc2hiYWxsLnh5ejBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJVl3ekGtLlFcNfEhmOHCLOVEemnyWOOXVv1tf5ErglibHnMVA1fG4I_ZgMeodQEKZ1ZNH71toMA61hK9yqCRwqjggLGMIICwjAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB_wQCMAAwHQYDVR0OBBYEFAnV7Ib3s5hJQRwosQSRujLvILhzMB8GA1UdIwQYMBaAFJMnRpgDqVFojpjWxEJI2yO_WJTSMFUGCCsGAQUFBwEBBEkwRzAhBggrBgEFBQcwAYYVaHR0cDovL2U2Lm8ubGVuY3Iub3JnMCIGCCsGAQUFBzAChhZodHRwOi8vZTYuaS5sZW5jci5vcmcvMIHOBgNVHREEgcYwgcOCPzM0YWU4YzEzLWRhYmMtNDczZi1hNzhmLTkzNTQyMGYzZTAyNi50ZXN0LmFjbWUucGtnLmZpc2hiYWxsLnh5eoI_OWExZDliMzItYzg2Yi00M2VkLThlOTItMDRmOTRmNDFmNjZmLnRlc3QuYWNtZS5wa2cuZmlzaGJhbGwueHl6gj9lMmJiOWY0Mi1hODEzLTRjNDktODdjOC1iNWI1MmFkYmRkYmQudGVzdC5hY21lLnBrZy5maXNoYmFsbC54eXowEwYDVR0gBAwwCjAIBgZngQwBAgEwggEEBgorBgEEAdZ5AgQCBIH1BIHyAPAAdwA_F0tP1yJHWJQdZRyEvg0S7ZA3fx-FauvBvyiF7PhkbgAAAZKUlTX3AAAEAwBIMEYCIQCErVMxw3csVQFM3-BWpbaoxROhzUHQV-ky_ZjUEyBCowIhAMnbI6Qv-Kxujx_PC-J8cbU2sYV-gSRheYcsCOuq3HZLAHUAzxFW7tUufK_zh1vZaS6b6RpxZ0qwF-ysAdJbd87MOwgAAAGSlJU2MwAABAMARjBEAiACvsQnAIcfeId85E9PyswDpO1BzMoiuMmxWlmqP30OqAIgHpqm27Wf9IG_agaaRBEdPsFBdRe82wZHAFFEiQ3Eip8wCgYIKoZIzj0EAwMDZwAwZAIwcY5tsdLBi-zAYuRVQrm6imDiwmiQhQkBpBlWjpApJ4mxu_LiI_Anhmw_jCxt9cFQAjA9Bn3O5xmEian4GOadWxgw8QKwnAOBYA_M68Xyq6zlg2zzpEac1bQgM0iNPe5vn6c
  expect(notBefore.toISOString()).toBe("2024-10-16T08:09:09.000Z");
  expect(notAfter.toISOString()).toBe("2025-01-14T08:09:08.000Z");
});
